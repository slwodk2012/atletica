<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Test</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #1a1a1a; color: white; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        #log { background: #333; padding: 15px; margin-top: 20px; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .info { color: #2196F3; }
    </style>
</head>
<body>
    <h1>üî• Firebase Test</h1>
    
    <div>
        <button onclick="testLoad()">1. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç—Ä–µ–Ω–µ—Ä–æ–≤</button>
        <button onclick="testSave()">2. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ—Å—Ç-—Ç—Ä–µ–Ω–µ—Ä–∞</button>
        <button onclick="testDelete()">3. –£–¥–∞–ª–∏—Ç—å —Ç–µ—Å—Ç-—Ç—Ä–µ–Ω–µ—Ä–∞</button>
        <button onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    </div>
    
    <div id="log"></div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, doc, setDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyH-dDrBQi4F_znZApbQo7aPOCO-kpkDWU",
            authDomain: "atletica-34ab2.firebaseapp.com",
            projectId: "atletica-34ab2",
            storageBucket: "atletica-34ab2.firebasestorage.app",
            messagingSenderId: "942801359590",
            appId: "1:942801359590:web:5Ad58ab145e59b2c6be977"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        function log(msg, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `<span class="${type}">[${time}] ${msg}</span>\n`;
        }

        window.clearLog = () => {
            document.getElementById('log').innerHTML = '';
        };

        window.testLoad = async () => {
            log('–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–µ–Ω–µ—Ä–æ–≤ –∏–∑ Firebase...', 'info');
            try {
                const querySnapshot = await getDocs(collection(db, 'trainers'));
                const trainers = [];
                querySnapshot.forEach((doc) => {
                    trainers.push({ id: doc.id, ...doc.data() });
                });
                log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${trainers.length} —Ç—Ä–µ–Ω–µ—Ä–æ–≤:`, 'success');
                trainers.forEach(t => {
                    log(`   - ${t.id}: ${t.title}`, 'info');
                });
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                log(`–ö–æ–¥ –æ—à–∏–±–∫–∏: ${error.code}`, 'error');
            }
        };

        window.testSave = async () => {
            log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç-—Ç—Ä–µ–Ω–µ—Ä–∞...', 'info');
            const testTrainer = {
                id: 'test-trainer-001',
                title: '–¢–µ—Å—Ç –¢—Ä–µ–Ω–µ—Ä',
                description: '–¢–µ—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ',
                category: '–§–∏—Ç–Ω–µ—Å',
                experience: '–°—Ç–∞–∂ 1 –≥–æ–¥',
                image: 'https://via.placeholder.com/400x600',
                price: 2500,
                currency: 'RUB'
            };
            try {
                await setDoc(doc(db, 'trainers', testTrainer.id), testTrainer);
                log(`‚úÖ –¢—Ä–µ–Ω–µ—Ä —Å–æ—Ö—Ä–∞–Ω–µ–Ω: ${testTrainer.id}`, 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${error.message}`, 'error');
                log(`–ö–æ–¥ –æ—à–∏–±–∫–∏: ${error.code}`, 'error');
                if (error.code === 'permission-denied') {
                    log('‚ö†Ô∏è –ù—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ Firebase Console!', 'error');
                    log('–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Firebase Console -> Firestore Database -> Rules', 'info');
                    log('–ò —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: allow read, write: if true;', 'info');
                }
            }
        };

        window.testDelete = async () => {
            log('–£–¥–∞–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç-—Ç—Ä–µ–Ω–µ—Ä–∞...', 'info');
            try {
                await deleteDoc(doc(db, 'trainers', 'test-trainer-001'));
                log('‚úÖ –¢–µ—Å—Ç-—Ç—Ä–µ–Ω–µ—Ä —É–¥–∞–ª–µ–Ω', 'success');
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        };

        // Auto-test on load
        log('Firebase –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
        log(`Project ID: ${firebaseConfig.projectId}`, 'info');
    </script>
</body>
</html>
