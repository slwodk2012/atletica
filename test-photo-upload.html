<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ</title>
    <style>
        body {
            background: #1a1a1a;
            color: #fff;
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .photo-input-wrapper {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        .photo-input {
            flex: 1;
            padding: 10px;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 6px;
            color: #fff;
        }
        .photo-upload-btn {
            background: #4CAF50;
            color: #fff;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            border: none;
            font-weight: 600;
        }
        .photo-upload-btn:hover {
            background: #45a049;
        }
        .preview {
            max-width: 100%;
            max-height: 400px;
            border-radius: 8px;
            margin-top: 15px;
            border: 2px solid #444;
        }
        .success { color: #4CAF50; }
        .error { color: #ff4444; }
        .info { color: #2196F3; }
    </style>
</head>
<body>
    <h1>üì∏ –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</h1>
    
    <div class="test-section">
        <h2>–ó–∞–≥—Ä—É–∑–∫–∞ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h2>
        <p class="info">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–º–∞–∫—Å. 5 –ú–ë)</p>
        
        <div class="photo-input-wrapper">
            <input type="text" id="photoUrl" class="photo-input" placeholder="Base64 –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å..." readonly>
            <label for="photoFile" class="photo-upload-btn">üìÅ –í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</label>
            <input type="file" id="photoFile" accept="image/*" style="display: none;">
        </div>
        
        <div id="result"></div>
        <img id="preview" class="preview" style="display: none;">
    </div>
    
    <div class="test-section">
        <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
        <div id="info"></div>
    </div>

    <script>
        const fileInput = document.getElementById('photoFile');
        const urlInput = document.getElementById('photoUrl');
        const preview = document.getElementById('preview');
        const result = document.getElementById('result');
        const info = document.getElementById('info');

        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            result.innerHTML = '<p class="info">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</p>';

            // Validate
            if (!file.type.startsWith('image/')) {
                result.innerHTML = '<p class="error">‚ùå –≠—Ç–æ –Ω–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ!</p>';
                return;
            }

            const maxSize = 5 * 1024 * 1024;
            if (file.size > maxSize) {
                result.innerHTML = '<p class="error">‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 5 –ú–ë)</p>';
                return;
            }

            try {
                // Convert to base64
                const base64 = await fileToBase64(file);
                
                // Show result
                urlInput.value = base64.substring(0, 100) + '...';
                preview.src = base64;
                preview.style.display = 'block';
                
                result.innerHTML = '<p class="success">‚úÖ –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!</p>';
                
                // Show info
                const sizeKB = (file.size / 1024).toFixed(2);
                const base64Size = (base64.length / 1024).toFixed(2);
                info.innerHTML = `
                    <p><strong>–ò–º—è —Ñ–∞–π–ª–∞:</strong> ${file.name}</p>
                    <p><strong>–¢–∏–ø:</strong> ${file.type}</p>
                    <p><strong>–†–∞–∑–º–µ—Ä –æ—Ä–∏–≥–∏–Ω–∞–ª–∞:</strong> ${sizeKB} –ö–ë</p>
                    <p><strong>–†–∞–∑–º–µ—Ä base64:</strong> ${base64Size} –ö–ë</p>
                    <p><strong>–£–≤–µ–ª–∏—á–µ–Ω–∏–µ:</strong> ${((base64Size / sizeKB - 1) * 100).toFixed(1)}%</p>
                    <p class="info">üí° Base64 —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä –ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞ 33%</p>
                `;

                // Test localStorage
                try {
                    localStorage.setItem('testPhoto', base64);
                    const saved = localStorage.getItem('testPhoto');
                    if (saved === base64) {
                        info.innerHTML += '<p class="success">‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage —Ä–∞–±–æ—Ç–∞–µ—Ç!</p>';
                    }
                    localStorage.removeItem('testPhoto');
                } catch (e) {
                    info.innerHTML += '<p class="error">‚ùå –û—à–∏–±–∫–∞ localStorage: ' + e.message + '</p>';
                }

            } catch (error) {
                result.innerHTML = '<p class="error">‚ùå –û—à–∏–±–∫–∞: ' + error.message + '</p>';
            }
        });

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = () => reject(new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª'));
                reader.readAsDataURL(file);
            });
        }

        // Show localStorage info
        const used = new Blob(Object.values(localStorage)).size;
        const usedMB = (used / 1024 / 1024).toFixed(2);
        info.innerHTML = `
            <p><strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ localStorage:</strong> ${usedMB} –ú–ë</p>
            <p class="info">üí° –û–±—ã—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ 5-10 –ú–ë</p>
        `;
    </script>
</body>
</html>
